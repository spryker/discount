{% extends '@Gui/Layout/layout.twig' %}

{% set section_title = 'Generated Vouchers View' %}

{% block action %}
    {{ backActionButton('/discount/pool', 'Back to Vouchers' | trans) }}
    {{ viewActionButton('/discount/voucher/export?id-pool=' ~ idPool, 'Export' | trans) }}
{% endblock %}

{% block content %}

    {% embed '@Gui/Partials/widget.twig' with { widget_title: section_title } %}

        {% block widget_content %}

            <table class="table table-striped table-bordered table-hover">
                <tr>
                    <td>Valid until</td>
                    <td>{{ discount.validTo | date }}</td>
                </tr>
                <tr>
                    <td>Value</td>
                    <td>{% if discount.type == 'percent' %}{{ discount.amount }} %{% else %}{{ discount.amount }}{% endif %}</td>
                </tr>
                <tr>
                    <td>Generated Vouchers</td>
                    <td>{{ countVouchers }}</td>
                </tr>
            </table>

        {% endblock %}

    {% endembed %}

    {% embed '@Gui/Partials/widget.twig' with { widget_title: 'Generated Codes' } %}

        {% block widget_header_content %}
            {% if batchValue is not null %}
            {{ viewActionButton('/discount/voucher/export?id-pool=' ~ idPool ~ '&batch=' ~ batchValue, 'Export Generated Codes' | trans) }}
            {% endif %}
        {% endblock %}

        {% block widget_content %}

            {{ generatedCodes | raw }}

        {% endblock %}

    {% endembed %}

{% endblock %}


{% block footer_js %}
    {{ parent() }}
    <script>
        $('.table-data-codes').DataTable({
            bRegex: false,
            bSmart: false,
            initComplete: function () {
                this.api().columns().every( function () {
                    var column = this;
                    var select = $('<select><option value=""></option></select>')
                        .appendTo( $(column.footer()).empty() )
                        .on( 'change', function () {
                            var val = $.fn.dataTable.util.escapeRegex(
                                $(this).val()
                            );

                            column
                                .search( val ? '^'+val+'$' : '', true, false )
                                .draw();
                        } );

                    column.data().unique().sort().each( function ( d, j ) {
                        select.append( '<option value="'+d+'">'+d+'</option>' )
                    } );
                } );
            }
        });
    </script>
{% endblock %}
